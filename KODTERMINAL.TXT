# Ustaw ścieżki źródłową i docelową
$source = "C:\Users\Dell\Desktop\git nowy\transport\src"
$destination = "C:\Users\Dell\Desktop\git nowy\transport\samepliki"

# Sprawdź, czy folder docelowy istnieje, jeśli nie - utwórz go
if (-not (Test-Path $destination)) {
    New-Item -ItemType Directory -Path $destination | Out-Null
}

# Przeszukaj rekurencyjnie wszystkie pliki w folderze źródłowym
Get-ChildItem -Path $source -Recurse -File | ForEach-Object {
    # Utwórz nazwę pliku ze ścieżką względną
    $relativePath = $_.FullName.Substring($source.Length + 1)
    $safeFileName = $relativePath -replace '[\\:]', '_'
    
    # Ustal ścieżkę docelową
    $destinationFile = Join-Path $destination $safeFileName
    
    # Jeśli plik o tej samej nazwie już istnieje, dodaj licznik
    if (Test-Path $destinationFile) {
        $counter = 1
        do {
            $destinationFile = Join-Path $destination "$safeFileName`_$counter"
            $counter++
        } while (Test-Path $destinationFile)
    }
    
    # Skopiuj plik do folderu docelowego
    # Upewnij się, że folder docelowy istnieje
    $destinationDir = Split-Path $destinationFile
    if (-not (Test-Path $destinationDir)) {
        New-Item -ItemType Directory -Path $destinationDir | Out-Null
    }
    
    Copy-Item $_.FullName -Destination $destinationFile
}

Write-Host "Kopiowanie plików zakończone."
